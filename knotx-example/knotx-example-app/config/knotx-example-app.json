{
  "modules": [
    "java:io.knotx.server.KnotxServerVerticle",
    "java:io.knotx.repository.HttpRepositoryConnectorVerticle",
    "java:io.knotx.repository.FilesystemRepositoryConnectorVerticle",
    "java:io.knotx.knot.splitter.FragmentSplitterVerticle",
    "java:io.knotx.knot.assembler.FragmentAssemblerVerticle",
    "java:io.knotx.knot.templating.HandlebarsKnotVerticle",
    "java:io.knotx.knot.service.ServiceKnotVerticle",
    "java:io.knotx.knot.action.ActionKnotVerticle",
    "java:io.knotx.adapter.service.http.HttpServiceAdapterVerticle",
    "java:io.knotx.adapter.action.http.HttpActionAdapterVerticle",
    "java:io.knotx.mocks.MockRemoteRepositoryVerticle",
    "java:io.knotx.mocks.MockServiceVerticle",
    "java:io.knotx.gateway.GatewayKnotVerticle",
    "java:io.knotx.gateway.RequestProcessorKnotVerticle",
    "java:io.knotx.gateway.ResponseProviderKnotVerticle"
  ],
  "config": {
    "java:io.knotx.server.KnotxServerVerticle": {
      "options": {
        "config": {
          "defaultFlow": {
            "repositories": [
              {
                "path": "/content/local/.*",
                "address": "knotx.core.repository.filesystem"
              },
              {
                "path": "/content/.*",
                "address": "knotx.core.repository.http"
              },
              {
                "path": "/img/.*",
                "address": "knotx.core.repository.http",
                "doProcessing": false
              }
            ],
            "routing": {
              "GET": {
                "items": [
                  {
                    "path": "/content/.*",
                    "address": "knotx.knot.action",
                    "onTransition": {
                      "next": {
                        "address": "knotx.knot.service",
                        "onTransition": {
                          "next": {
                            "address": "knotx.knot.handlebars"
                          }
                        }
                      }
                    }
                  }
                ]
              },
              "POST": {
                "items": [
                  {
                    "path": "/content/.*",
                    "address": "knotx.knot.action",
                    "onTransition": {
                      "next": {
                        "address": "knotx.knot.service",
                        "onTransition": {
                          "next": {
                            "address": "knotx.knot.handlebars"
                          }
                        }
                      }
                    }
                  }
                ]
              }
            }
          },
          "customFlow": {
            "routing": {
              "GET": {
                "items": [
                  {
                    "path": "/customFlow/.*",
                    "address": "knotx.gateway.gatewayknot",
                    "onTransition": {
                      "next": {
                        "address": "knotx.gateway.requestprocessor"
                      }
                    }
                  }
                ]
              },
              "PUT": {
                "items": [
                  {
                    "path": "/customFlow/.*",
                    "address": "knotx.gateway.gatewayknot",
                    "onTransition": {
                      "next": {
                        "address": "knotx.gateway.requestprocessor"
                      }
                    }
                  }
                ]
              }
            }
          }
        }
      }
    },
    "java:io.knotx.mocks.MockRemoteRepositoryVerticle": {
      "options": {
        "config": {
          "mockDataRoot": "mock/repository",
          "httpPort": 3001
        }
      }
    },
    "java:io.knotx.mocks.MockServiceVerticle": {
      "options": {
        "config": {
          "mockDataRoot": "mock/service",
          "bouncing": true,
          "httpPort": 3000
        }
      }
    },
    "java:io.knotx.gateway.RequestProcessorKnotVerticle": {
      "options": {
        "config": {
          "address": "knotx.gateway.requestprocessor"
        }
      }
    },
    "java:io.knotx.adapter.action.http.HttpActionAdapterVerticle": {
      "options": {
        "config": {
          "address": "knotx.adapter.action.http",
          "clientOptions": {
            "maxPoolSize": 1000,
            "keepAlive": false
          },
          "customRequestHeader": {
            "name": "Server-User-Agent",
            "value": "Knot.x"
          },
          "services": [
            {
              "path": "/service/mock/.*",
              "domain": "localhost",
              "port": 3000,
              "allowedRequestHeaders": [
                "Content-Type",
                "X-*"
              ]
            },
            {
              "path": "/service/.*",
              "domain": "localhost",
              "port": 8080,
              "allowedRequestHeaders": [
                "Content-Type",
                "X-*"
              ]
            }
          ]
        }
      }
    },
    "java:io.knotx.knot.action.ActionKnotVerticle": {
      "options": {
        "config": {
          "adapters": [
            {
              "name": "subscribe-competition",
              "address": "knotx.adapter.action.http",
              "params": {
                "path": "/service/mock/post-competition.json"
              },
              "allowedRequestHeaders": [
                "Cookie"
              ],
              "allowedResponseHeaders": [
                "Set-Cookie",
                "Location"
              ]
            },
            {
              "name": "subscribe-newsletter",
              "address": "knotx.adapter.action.http",
              "params": {
                "path": "/service/mock/post-newsletter.json"
              },
              "allowedRequestHeaders": [
                "Cookie"
              ],
              "allowedResponseHeaders": [
                "Set-Cookie",
                "Location"
              ]
            },
            {
              "name": "step1",
              "address": "knotx.adapter.action.http",
              "params": {
                "path": "/service/mock/post-step-1.json"
              },
              "allowedRequestHeaders": [
                "Cookie",
                "Content-Type",
                "Content-Length"
              ],
              "allowedResponseHeaders": [
                "Set-Cookie",
                "Location"
              ]
            },
            {
              "name": "step2",
              "address": "knotx.adapter.action.http",
              "params": {
                "path": "/service/mock/post-step-2.json"
              },
              "allowedRequestHeaders": [
                "Cookie",
                "Content-Type",
                "Content-Length"
              ],
              "allowedResponseHeaders": [
                "Set-Cookie",
                "Location"
              ]
            }
          ]
        }
      }
    },
    "java:io.knotx.knot.service.ServiceKnotVerticle": {
      "options": {
        "config": {
          "services": [
            {
              "name": "first-service",
              "address": "knotx.adapter.service.http",
              "params": {
                "path": "/service/mock/first.json"
              },
              "cacheKey": "first"
            },
            {
              "name": "second-service",
              "address": "knotx.adapter.service.http",
              "params": {
                "path": "/service/mock/second.json"
              }
            },
            {
              "name": "third-service",
              "address": "knotx.adapter.service.http",
              "params": {
                "path": "/service/mock/third.json"
              }
            },
            {
              "name": "labelsRepository",
              "address": "knotx.adapter.service.http"
            }
          ]
        }
      }
    }
  }
}
